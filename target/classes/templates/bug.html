<!DOCTYPE html>
<html>
<head>
    <title>Bug信息</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link href="/static/bootstrap4/css/bootstrap.min.css" rel="stylesheet">
    <script src="/static/bootstrap4/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.18.0/axios.js" type="text/javascript"></script>
    <style type="text/css">
        table
        {
            border-collapse: collapse;
            margin: 0 auto;
            text-align: center;
        }
        table td, table th
        {
            border: 1px solid #cad9ea;
            color: #666;
            height: 30px;
        }
        table thead th
        {
            background-color: #CCE8EB;
            width: 100px;
        }
        table tr:nth-child(odd)
        {
            background: #fff;
        }
        table tr:nth-child(even)
        {
            background: #F5FAFA;
        }
    </style>

</head>
<body>
<div class="container-fluid">
    <div class="row-fluid" id="BugList">
        <div class="span12 text-center">
            <h3>Defects4dl</h3>
            <div>--A deep learning General Bug library</div>
        </div>

        <form class="form-search form-inline" id="bug_form">

            <table width="90%" class="table table-condensed">
                <thead>
                <tr>
                    <th colspan="4" class="text-center">Bug Overview</th>
                </tr>
                </thead>

                <tbody>
                <tr>
                    <td class="item-title">Count of Bugs</td>
                    <td colspan="3">{{ bugCount }}</td>
                </tr>
                <tr>
                    <td class="item-title">Count of Shape Mismatch type</td>
                    <td>{{ smCount }}</td>
                    <td class="item-title">Count of API type</td>
                    <td>{{ apiCount }}</td>
                </tr>
                <tr>
                    <td class="item-title">Count of type Mismatch type</td>
                    <td>{{ tmCount }}</td>
                    <td class="item-title"></td>
                    <td></td>
                </tr>

            </table>


            <div class="form-group query-form-group">
                <label>General Bug Type&nbsp;&nbsp;</label>
                <select class="form-control" id="with_appr_status">
                    <option value="">All</option>
                    <option value="S1">shape mismatch</option>
                    <option value="S2">API</option>
                </select>
            </div>&nbsp;&nbsp;
            <div class="form-group query-form-group">
                <button type="button" class="btn btn-primary btn-sm" id="query_Type" >查询</button>
            </div>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <div class="form-group query-form-group">
                <label>ErrorMessage&nbsp;&nbsp;</label>
                <select class="form-control" id="">
                    <option value="">All</option>
                    <option value="S1">ValueError</option>
                    <option value="S2">TypeError</option>
                </select>
            </div>&nbsp;&nbsp;
            <div class="form-group query-form-group">
                <button type="button" class="btn btn-primary btn-sm" id="query_ErrorMessage" >查询</button>
            </div>

            <table width="90%" class="table table-hover">
                <thead>
                <tr>
                    <th colspan="5" class="text-center">Bug Info</th>
                </tr>
                <tr>
                    <th style="width: 30px">
                        ID
                    </th>
                    <th style="width: 30px">
                        ErrorMessage
                    </th>
                    <th style="width: 30px">
                        General Bug Type
                    </th>
                    <th style="width: 30px">
                        Describe
                    </th>
                    <th style="width: 30px">
                        操作
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="item in dataList">
                    <td>
                        {{ item.bugs[0].bugID }}
                    </td>
                    <td>
                        {{ item.bugs[0].errorMessage }}
                    </td>
                    <td>
                        {{ item.bugs[0].type }}
                    </td>
                    <td>
                        {{ item.bugs[0].describe }}
                    </td>
                    <td>
                        <button type="button" class="btn btn-info btn-sm">详情</button>
                    </td>
                </tr>

                </tbody>
            </table>

        </form>
    </div>
</div>

</body>



<!-- js -->
<script src="/static/vue.min.js"></script>
<script>
    var vm = new Vue({
        el: '#BugList',
        data:{
            bugID: null,
            errorMessage: null,
            type: null,
            describe: null,
            bugCount: null,
            smCount: null,
            apiCount: null,
            tmCount: null,
            dataList: [],
        },
        mounted: function () {
            //调用在method属性中定义的方法
            this.initBug();

        },
        //所有自定义的方法都是写在method属性中，然后通过mounted属性this.方法名来加载调用
        methods: {
            initBug: function() {
                axios.get("getBug")
                    .then(response => {
                        console.log(response.data);
                        vm.dataList = response.data;
                        vm.bugCount = response.data.length;

                        var smCount = 0;
                        var apiCount = 0;
                        var tmCount = 0;
                        for(var i=0;i<response.data.length;i++){
                            if (response.data[i].bugs[0].type == "shape mismatch"){
                                smCount++;
                            }
                            else if(response.data[i].bugs[0].type == "API"){
                                apiCount++;
                            }else if (response.data[i].bugs[0].type == "type mismatch"){
                                tmCount++;
                            }
                        }
                        vm.smCount = smCount;
                        vm.apiCount = apiCount;
                        vm.tmCount = tmCount;

                    })
            },
            selectByType: function (typeName){
                var SelectTypeList = [];
                for(var i=0;i<vm.dataList.length;i++) {
                    if (vm.dataList[i].bugs[0].type == typeName) {
                        SelectTypeList.add(vm.dataList[i])
                    }
                }
                vm.dataList = SelectTypeList;
            },
            selectByError: function (errorName){
                var SelectErrorList = [];
                for(var i=0;i<vm.dataList.length;i++){
                    if(vm.dataList[i].bugs[0].errorMessage == errorName){
                        SelectErrorList.add(vm.dataList[i])
                    }
                }
                vm.dataList = SelectErrorList;
            },

        }

    })

    // $(function () {
    //     $.ajax({
    //         url: "http://localhost:8080/bug", success: function (result) {
    //             alert(result);
    //
    //             // var res = result;
    //             // res = res.replace('{', '').replace('}', '')
    //             // console.log(res)
    //             // var list = res.split(',')
    //             // console.log(list)
    //             // var map = []
    //             // list.forEach(item => {
    //             //     var itemEle = item.split('=')
    //             //     if (itemEle.length == 2)
    //             //         map.push({
    //             //             ErrorMessage: itemEle[0].trim(),
    //             //             Describe: itemEle[1].trim(),
    //             //         })
    //             // })
    //             // console.log(map)
    //         }
    //     });
    // })

</script>

</html>